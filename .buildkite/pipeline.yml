# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json

steps:

  - label: "Trigger Auditbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - auditbeat/**
        - .buildkite/auditbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "auditbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Auditbeat"
    if: build.pull_request.id == null
    trigger: "auditbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Heartbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - heartbeat/**
        - .buildkite/heartbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "heartbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Heartbeat"
    if: build.pull_request.id == null
    trigger: "heartbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Filebeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - filebeat/**
        - .buildkite/filebeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "filebeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Filebeat"
    if: build.pull_request.id == null
    trigger: "filebeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/filebeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - filebeat/**
        - x-pack/filebeat/**
        - .buildkite/x-pack/pipeline.xpack.filebeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
        - .buildkite/deploy/docker/docker-compose.yml
    trigger: "beats-xpack-filebeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/filebeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-filebeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/dockerlogbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - x-pack/dockerlogbeat/**
        - .buildkite/x-pack/pipeline.xpack.dockerlogbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-dockerlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/dockerlogbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-dockerlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Metricbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - metricbeat/**
        - .buildkite/metricbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-metricbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Metricbeat"
    if: build.pull_request.id == null
    trigger: "beats-metricbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/metricbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - metricbeat/**
        - x-pack/metricbeat/**
        - .buildkite/x-pack/pipeline.xpack.metricbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
        - .buildkite/deploy/docker/docker-compose.yml
    trigger: "beats-xpack-metricbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/metricbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-metricbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/osquerybeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - x-pack/osquerybeat/**
        - .buildkite/x-pack/pipeline.xpack.osquerybeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-osquerybeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/osquerybeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-osquerybeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/winlogbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - winlogbeat/**
        - x-pack/winlogbeat/**
        - .buildkite/x-pack/pipeline.xpack.winlogbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-winlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/winlogbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-winlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Deploy/K8S"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - deploy/kubernetes/**
        - metricbeat/module/kubernetes/**
        # Shared OSS dependencies
        - .go-version
        - libbeat/docs/version.asciidoc
        # Shared CI infrastructure
        - .buildkite/deploy/kubernetes/**
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "deploy-k8s"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Deploy/K8S"
    if: build.pull_request.id == null
    trigger: "deploy-k8s"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Libbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - libbeat/**
        - .buildkite/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-libbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Libbeat"
    if: build.pull_request.id == null
    trigger: "beats-libbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/libbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - x-pack/libbeat/**
        - .buildkite/x-pack/pipeline.xpack.libbeat.yml
        # Shared OSS dependencies
        - .go-version
        - libbeat/**
        - go.mod
        - pytest.ini
        - dev-tools/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-libbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/libbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-libbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/otel"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - x-pack/otel/**
        - .buildkite/x-pack/pipeline.xpack.otel.yml
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - dev-tools/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-otel"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/otel"
    if: build.pull_request.id == null
    trigger: "beats-xpack-otel"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/auditbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - auditbeat/**
        - x-pack/auditbeat/**
        - .buildkite/x-pack/pipeline.xpack.auditbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-auditbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/auditbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-auditbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/heartbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - heartbeat/**
        - x-pack/heartbeat/**
        - .buildkite/x-pack/pipeline.xpack.heartbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-heartbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/heartbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-heartbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger x-pack/packetbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - packetbeat/**
        - x-pack/packetbeat/**
        - .buildkite/x-pack/pipeline.xpack.packetbeat.yml
        # Shared x-pack dependencies
        - x-pack/libbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-xpack-packetbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for x-pack/packetbeat"
    if: build.pull_request.id == null
    trigger: "beats-xpack-packetbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Winlogbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - winlogbeat/**
        - .buildkite/winlogbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-winlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Winlogbeat"
    if: build.pull_request.id == null
    trigger: "beats-winlogbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - label: "Trigger Packetbeat"
    if: build.pull_request.id != null
    if_changed:
      include:
        # Beat-specific paths
        - packetbeat/**
        - .buildkite/packetbeat/**
        # Shared OSS dependencies
        - .go-version
        - go.mod
        - pytest.ini
        - dev-tools/**
        - libbeat/**
        - testing/**
        # Shared CI infrastructure
        - .buildkite/pipeline.yml
        - .buildkite/scripts/**
        - .buildkite/hooks/**
    trigger: "beats-packetbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: ${BUILDKITE_PULL_REQUEST}
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: ${BUILDKITE_PULL_REQUEST_BASE_BRANCH}
        GITHUB_PR_LABELS: ${GITHUB_PR_LABELS}

  - label: "Triggering Build for Packetbeat"
    if: build.pull_request.id == null
    trigger: "beats-packetbeat"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  # Triggers Serverless Beats tests in the elastic-agent repo for main/release branches
  - label: "Serverless beats tests(elastic-agent)"
    if: build.pull_request.id == null
    trigger: "beats-agent-serverless-tests"
    build:
      branch: "main"
