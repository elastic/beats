#!/bin/bash

set -euo pipefail

source .buildkite/metricbeat/scripts/common.sh

echo "Golang version:"
version=$(cat .go-version)
GO_VERSION="${version}"
export GO_VERSION
echo "${GO_VERSION}"

# TODO remove in final steps: image will tools for beats
if [[ "$BUILDKITE_PIPELINE_SLUG" == "beats-metricbeat" && "$BUILDKITE_STEP_KEY" =~ ^mandatory- ]]; then
    echo "--- prepare env"
    sudo apt-get update
    sudo apt-get install -y libsystemd-dev
    sudo apt install -y python3-pip
    sudo apt-get install -y python3-venv
    add_bin_path
    with_go ${GO_VERSION}
    with_mage
fi

# if [[ "$BUILDKITE_PIPELINE_SLUG" == "beats-metricbeat" && "$BUILDKITE_STEP_KEY" =~ ^extended- ]]; then
#     add_bin_path
#     with_go ${GO_VERSION}
#     with_mage
# fi
