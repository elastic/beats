description: Pipeline for parsing F5 ASM web application firewall logs

on_failure:
- 
  set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'

processors:
-
  set:
    field: event.ingested
    value: '{{_ingest.timestamp}}'
- 
  grok:
    field: message
    patterns:
    - '^<%{NONNEGINT:syslog5424_ver}>+(?:%{SYSLOGTIMESTAMP:syslog5424_ts}|-) +(?:%{IPORHOST:syslog5424_host}|-) +(-|%{WORD:syslog5424_app}):%{GREEDYDATA:syslog5424_content}$'
-
  grok:
    field: syslog5424_content
    patterns:
    - '^"%{IP:source.ip}"###"%{DATA:client.country}"###"%{DATA}"###"%{DATA:source.port}"###"%{IP:destination.ip}"###"%{DATA:destination.port}"###"%{DATA:network.protocol}"###"%{WORD:http.request.method}"###"%{DATA:uri}"###"%{IP:source.ip}"###"%{WORD:result}"###"%{DATA:event.id}"###"%{DATA}"###"%{DATA}"###"%{DATA}"###"%{DATA}"###"%{DATA}"###"%{DATA}"###"%{DATA:rule.name}"###"%{DATA}"###"%{DATA}"###"%{DATA}"###"%{DATA:request}"###"%{DATA:event.reason}"###""$'
-
  set:
    field: event.module
    value: 'f5'
-
  set:
    field: event.kind
    value: '{{syslog5424_app}}'
-
  set:
    field: event.category
    value: network
-
  set:
    field: observer.vendor
    value: F5 Networks
-
  set:
    field: observer.type
    value: firewall
-
  set:
    field: event.outcome
    value: success
    if: '[''passed'',''alerted''].contains(ctx.result)'
-
  set:
    field: event.outcome
    value: failure
    if: '[''blocked''].contains(ctx.result)'
-
  set:
    field: event.outcome
    value: unknown
    if: ctx.event?.outcome == null
-
  remove:
    ignore_missing: true
    field:
    - syslog5424_content
    - syslog5424_sd
    - syslog5424_app
    - syslog5424_host
    - syslog5424_msgid
    - syslog5424_pri
    - syslog5424_proc
    - syslog5424_ver
    - message
    - host
    - request
    - client.country
    - result