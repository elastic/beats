description: Pipeline for parsing logstash node logs
processors:
- rename:
    field: '@timestamp'
    target_field: event.created
- set:
    field: is_json
    value: true
- json:
    field: message
    target_field: logstash.log
    on_failure:
      - set:
          field: is_json
          value: false
- pipeline:
    if: ctx.is_json == true
    name: '{< IngestPipeline "pipeline-json" >}'
- pipeline:
    if: ctx.is_json == false
    name: '{< IngestPipeline "pipeline-plaintext" >}'
- remove:
    field:
      - is_json
on_failure:
  - set:
      field: error.message
      value: '{{ _ingest.on_failure_message }}'
