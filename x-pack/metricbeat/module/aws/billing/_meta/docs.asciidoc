You can monitor your estimated AWS charges by using Amazon CloudWatch and Cost
Explorer.

This aws `billing` metricset collects metrics both from Cloudwatch and cost
explorer for monitoring purposes.

[float]
=== AWS Permissions
Some specific AWS permissions are required for IAM user to collect estimated
billing metrics.
----
cloudwatch:GetMetricData
cloudwatch:ListMetrics
tag:getResources
sts:GetCallerIdentity
iam:ListAccountAliases
ce:GetCostAndUsage
organizations:ListAccounts
----

[float]
=== Dashboard

The aws billing metricset comes with a predefined dashboard. For example:

image::./images/metricbeat-aws-billing-overview.png[]

[float]
=== Configuration example
[source,yaml]
----
- module: aws
  period: 24h
  metricsets:
    - billing
  credential_profile_name: elastic-beats
  cost_explorer_config:
    group_by_primary_keys:
      - "AZ"
      - "INSTANCE_TYPE"
      - "SERVICE"
    group_by_secondary_keys:
      - "aws:createdBy"
----

[float]
=== Metricset-specific configuration notes
When querying AWS Cost Explorer API, you can group AWS costs using up to two
different groups, either dimensions (`DIMENSION`), tags (`TAG`), or both. Currently the following configuration options are available:

* *group_by_primary_type* The type of group for the primary keys, supports either `DIMENSION` or `TAG`. Default `DIMENSION`.
* *group_by_primary_keys* A list of keys used in Cost Explorer to group by. It can either by a list of dimension values or a list of tags, but needs to match the type set by *group_by_primary_type*.
* *group_by_secondary_type* The type of group for the secondary keys, supports either `DIMENSION` or `TAG`. Default `TAG`.
* *group_by_secondary_keys* A list of keys used in Cost Explorer to group by. It can either by a list of dimension values or a list of tags, but needs to match the type set by *group_by_secondary_type*.

Currently supported values for `DIMENSION` keys are: AZ, INSTANCE_TYPE, LINKED_ACCOUNT, OPERATION, PURCHASE_TYPE, SERVICE, USAGE_TYPE, PLATFORM, TENANCY, RECORD_TYPE, LEGAL_ENTITY_NAME, INVOICING_ENTITY, DEPLOYMENT_OPTION, DATABASE_ENGINE, CACHE_ENGINE, INSTANCE_TYPE_FAMILY, REGION, BILLING_ENTITY, RESERVATION_ID, SAVINGS_PLANS_TYPE, SAVINGS_PLAN_ARN, OPERATING_SYSTEM
