default: true
input:
  module: windows
  metricset: perfmon
  defaults:
    perfmon.group_measurements_by_instance: true
    perfmon.ignore_non_existent_counters: true
    perfmon.queries:
    - object: 'Web Service'
      instance: "*"
      counters:
      - name: 'Total Bytes Received'
      - name: 'Total Bytes Sent'
      - name: "Bytes Sent/sec"
      - name: "Bytes Received/sec"
      - name: "Current Connections"
      - name: "Maximum Connections"
      - name: "Total Connection Attempts (all instances)"
        field: total_connection_attempts
      - name: "Total Get Requests"
      - name: "Get Requests/sec"
      - name: "Total Post Requests"
      - name: "Post Requests/sec"
      - name: "Total Delete Requests"
      - name: "Delete Requests/sec"
      - name: "Service Uptime"
      - name: "Total PUT Requests"
      - name: "PUT Requests/sec"

processors:
- drop_event.when.equals:
    iis.website.name: '_Total'
- rename:
    ignore_missing: true
    fields:
    - from: "iis.website.metrics.total_bytes_received"
      to: "iis.website.total_bytes_received"
    - from: "iis.website.metrics.total_bytes_sent"
      to: "iis.website.total_bytes_sent"
    - from: "iis.website.metrics.bytes_sent_per_sec"
      to: "iis.website.bytes_sent_per_sec"
    - from: "iis.website.metrics.bytes_received_per_sec"
      to: "iis.website.bytes_received_per_sec"
    - from: "iis.website.metrics.current_connections"
      to: "iis.website.current_connections"
    - from: "iis.website.metrics.maximum_connections"
      to: "iis.website.maximum_connections"
    - from: "iis.website.metrics.total_connection_attempts"
      to: "iis.website.total_connection_attempts"
    - from: "iis.website.metrics.total_get_requests"
      to: "iis.website.total_get_requests"
    - from: "iis.website.metrics.get_requests_per_sec"
      to: "iis.website.get_requests_per_sec"
    - from: "iis.website.metrics.total_post_requests"
      to: "iis.website.total_post_requests"
    - from: "iis.website.metrics.post_requests_per_sec"
      to: "iis.website.post_requests_per_sec"
    - from: "iis.website.metrics.total_delete_requests"
      to: "iis.website.total_delete_requests"
    - from: "iis.website.metrics.delete_requests_per_sec"
      to: "iis.website.delete_requests_per_sec"
    - from: "iis.website.metrics.service_uptime"
      to: "iis.website.service_uptime"
    - from: "iis.website.metrics.total_put_requests"
      to: "iis.website.total_put_requests"
    - from: "iis.website.metrics.put_requests_per_sec"
      to: "iis.website.put_requests_per_sec"
    - from: "iis.website.instance"
      to: "iis.website.name"
- drop_fields:
    fields: ["iis.website.object", "iis.website.metrics"]




