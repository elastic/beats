name: Filebeat
cmd: filebeat
args: ["-E", "setup.ilm.enabled=false", "-E", "setup.template.enabled=false", "-E", "management.mode=x-pack-fleet", "-E", "management.enabled=true"]
configurable: grpc
rules:
- filter_values:
    selector: streams
    key: type
    values:
    - logs
- map:
    path: streams
    rules:
    - translate:
        path: input.type
        mapper:
          event/file: log
          event/stdin: stdin
          event/tcp: tcp
          event/udp: udp
          log/docker: docker
          log/redis_slowlog: redis
          log/syslog: syslog
- filter_values:
    selector: streams.input.type
    key: type
    values:
    - log
    - stdin
    - udp
    - tcp
    - docker
    - redis
    - syslog
- map:
    path: streams
    rules:
    - rename:
        from: input
        to: inputs
- copy:
    from: streams.inputs
    to: filebeat
# - filter:
#     selectors:
#     - filebeat
#     - output
#     - keystore
when: HasItems(%{[filebeat.inputs]}) && HasNamespace('output', 'elasticsearch', 'redis',
  'kafka', 'logstash')
