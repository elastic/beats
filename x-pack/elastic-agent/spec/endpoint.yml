name: Endpoint
cmd: endpoint
service: 6788
install_checks:
- exec_file:
    path: "endpoint"
    args:
    - "verify"
post_install:
- exec_file:
    path: "endpoint"
    args:
    - "install"
    - "--upgrade"
    - "--resource"
    - "endpoint-resource.zip"
pre_uninstall:
- exec_file:
    path: "endpoint"
    args:
      - "uninstall"
rules:
- fix_stream: {}

- extract_list_items:
    path: datasources
    item: inputs
    to: inputs

- filter_values:
    selector: inputs
    key: type
    values:
    - endpoint

- filter_values:
    selector: inputs
    key: enabled
    values:
    - true

- overwrite:
    from: inputs.0
    to: ""
    except:
      - fleet
      - output

when: Equals(%{[type]}, 'endpoint') && HasAny('fleet') && HasNamespace('output', 'elasticsearch')
