// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
// or more contributor license agreements. Licensed under the Elastic License;
// you may not use this file except in compliance with the Elastic License.

//go:build windows

package main

import (
	"fmt"
	"io"
	"net/http"
	"regexp"
	"strings"

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/logger"
)

// isHexString is a compiled regex to check for valid hex strings.
var isHexString = regexp.MustCompile(`^[0-9a-fA-F]+$`)

// downloadPage performs a GET request
func downloadPage(url string, log *logger.Logger) (string, error) {
	client := &http.Client{}
	req, err := http.NewRequest("GET", url, nil)
	if err != nil {
		return "", err
	}

	resp, err := client.Do(req)
	if err != nil {
		return "", err
	}
	defer resp.Body.Close()

	// Check for non-2xx status codes
	if resp.StatusCode < 200 || resp.StatusCode >= 300 {
		resp.Body.Close() // Make sure to close the body on error
		return "", fmt.Errorf("bad status: %s", resp.Status)
	}

	bodyBytes, err := io.ReadAll(resp.Body)
	if err != nil {
		return "", err
	}

	return string(bodyBytes), nil
}

func writeCopyrightHeader(sb *strings.Builder) {
	sb.WriteString("// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n")
	sb.WriteString("// or more contributor license agreements. Licensed under the Elastic License;\n")
	sb.WriteString("// you may not use this file except in compliance with the Elastic License.\n\n")
	sb.WriteString("// Code generated by beats/x-pack/osquerybeat/ext/osquery-extension/pkg/jumplists/parsers/application_id_generate.go - DO NOT EDIT.\n\n")
	sb.WriteString("//go:build windows\n\n")
	sb.WriteString("package jumplists\n\n")
}
