// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
// or more contributor license agreements. Licensed under the Elastic License;
// you may not use this file except in compliance with the Elastic License.

// Code generated by gentables. DO NOT EDIT.
// Source: views/host_processes.yaml

//go:build linux

package hostprocesses

import (
	"fmt"
	"sync"

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/hooks"
	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/logger"
)

var (
	hooksFunc    func(*hooks.HookManager)
	registerOnce sync.Once
)

func createViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Create(socket, log)
}

func deleteViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Delete(socket, log)
}

// RegisterDefaultViewHook registers only the create/delete view hook with the hook manager.
// To add extra hooks, call RegisterHooksFunc with a function that calls RegisterDefaultViewHook(hm)
// then registers additional hooks on hm.
func RegisterDefaultViewHook(hm *hooks.HookManager) {
	hm.Register(hooks.NewHook("CreateHostProcessesView", createViewHook, deleteViewHook, View()))
}

// RegisterHooksFunc registers the hooks function for this view (optional).
// If called (e.g. from an implementation package), that function runs instead of the default.
// To add extra hooks while keeping the default view hook, pass a function that calls
// RegisterDefaultViewHook(hm) then registers additional hooks.
func RegisterHooksFunc(f func(*hooks.HookManager)) {
	registerOnce.Do(func() {
		hooksFunc = f
	})
}

// GetHooksFunc returns the registered hooks function for this view.
// Returns an error if no hooks function has been registered.
func GetHooksFunc() (func(*hooks.HookManager), error) {
	if hooksFunc == nil {
		return nil, fmt.Errorf("no hooks function registered for host_processes")
	}
	return hooksFunc, nil
}

// Result represents a row from the host_processes view.
type Result struct {
	Pid              int64  `osquery:"pid"`                // Process (or thread) ID
	Name             string `osquery:"name"`               // The process path or shorthand argv[0]
	Path             string `osquery:"path"`               // Path to executed binary
	Cmdline          string `osquery:"cmdline"`            // Complete argv (command line arguments)
	State            string `osquery:"state"`              // Process state (R=running, S=sleeping, D=disk sleep, Z=zombie, T=stopped)
	Cwd              string `osquery:"cwd"`                // Process current working directory
	Root             string `osquery:"root"`               // Process virtual root directory
	Uid              int64  `osquery:"uid"`                // Unsigned user ID (real UID)
	Gid              int64  `osquery:"gid"`                // Unsigned group ID (real GID)
	Euid             int64  `osquery:"euid"`               // Unsigned effective user ID
	Egid             int64  `osquery:"egid"`               // Unsigned effective group ID
	Suid             int64  `osquery:"suid"`               // Unsigned saved user ID
	Sgid             int64  `osquery:"sgid"`               // Unsigned saved group ID
	OnDisk           int32  `osquery:"on_disk"`            // The process path exists; yes=1, no=0, unknown=-1
	WiredSize        int64  `osquery:"wired_size"`         // Bytes of unpageable memory (always 0 on Linux)
	ResidentSize     int64  `osquery:"resident_size"`      // Bytes of private memory used by process (RSS)
	TotalSize        int64  `osquery:"total_size"`         // Total virtual memory size
	UserTime         int64  `osquery:"user_time"`          // CPU time in milliseconds spent in user space
	SystemTime       int64  `osquery:"system_time"`        // CPU time in milliseconds spent in kernel space
	DiskBytesRead    int64  `osquery:"disk_bytes_read"`    // Bytes read from disk
	DiskBytesWritten int64  `osquery:"disk_bytes_written"` // Bytes written to disk
	StartTime        int64  `osquery:"start_time"`         // Process start time in seconds since Epoch, or -1 if error
	Parent           int64  `osquery:"parent"`             // Process parent's PID (PPID)
	Pgroup           int64  `osquery:"pgroup"`             // Process group ID
	Threads          int32  `osquery:"threads"`            // Number of threads used by process
	Nice             int32  `osquery:"nice"`               // Process nice level (-20 to 20, default 0)
}

// View returns the view definition for host_processes.
// (Deprecated.) Backward-compatible view over elastic_host_processes; use elastic_host_processes instead.
//
// Columns:
//   - pid (BIGINT): Process (or thread) ID
//   - name (TEXT): The process path or shorthand argv[0]
//   - path (TEXT): Path to executed binary
//   - cmdline (TEXT): Complete argv (command line arguments)
//   - state (TEXT): Process state (R=running, S=sleeping, D=disk sleep, Z=zombie, T=stopped)
//   - cwd (TEXT): Process current working directory
//   - root (TEXT): Process virtual root directory
//   - uid (BIGINT): Unsigned user ID (real UID)
//   - gid (BIGINT): Unsigned group ID (real GID)
//   - euid (BIGINT): Unsigned effective user ID
//   - egid (BIGINT): Unsigned effective group ID
//   - suid (BIGINT): Unsigned saved user ID
//   - sgid (BIGINT): Unsigned saved group ID
//   - on_disk (INTEGER): The process path exists; yes=1, no=0, unknown=-1
//   - wired_size (BIGINT): Bytes of unpageable memory (always 0 on Linux)
//   - resident_size (BIGINT): Bytes of private memory used by process (RSS)
//   - total_size (BIGINT): Total virtual memory size
//   - user_time (BIGINT): CPU time in milliseconds spent in user space
//   - system_time (BIGINT): CPU time in milliseconds spent in kernel space
//   - disk_bytes_read (BIGINT): Bytes read from disk
//   - disk_bytes_written (BIGINT): Bytes written to disk
//   - start_time (BIGINT): Process start time in seconds since Epoch, or -1 if error
//   - parent (BIGINT): Process parent's PID (PPID)
//   - pgroup (BIGINT): Process group ID
//   - threads (INTEGER): Number of threads used by process
//   - nice (INTEGER): Process nice level (-20 to 20, default 0)
func View() *hooks.View {
	return hooks.NewView(
		"host_processes",
		[]string{"elastic_host_processes"},
		`CREATE VIEW host_processes AS
SELECT * FROM elastic_host_processes;`,
	)
}
