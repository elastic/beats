// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
// or more contributor license agreements. Licensed under the Elastic License;
// you may not use this file except in compliance with the Elastic License.

// Code generated by gentables. DO NOT EDIT.
// Source: views/host_groups.yaml

//go:build linux || darwin

package hostgroups

import (
	"fmt"
	"sync"

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/hooks"
	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/logger"
)

var (
	hooksFunc    func(*hooks.HookManager)
	registerOnce sync.Once
)

func createViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Create(socket, log)
}

func deleteViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Delete(socket, log)
}

// RegisterDefaultViewHook registers only the create/delete view hook with the hook manager.
// To add extra hooks, call RegisterHooksFunc with a function that calls RegisterDefaultViewHook(hm)
// then registers additional hooks on hm.
func RegisterDefaultViewHook(hm *hooks.HookManager) {
	hm.Register(hooks.NewHook("CreateHostGroupsView", createViewHook, deleteViewHook, View()))
}

// RegisterHooksFunc registers the hooks function for this view (optional).
// If called (e.g. from an implementation package), that function runs instead of the default.
// To add extra hooks while keeping the default view hook, pass a function that calls
// RegisterDefaultViewHook(hm) then registers additional hooks.
func RegisterHooksFunc(f func(*hooks.HookManager)) {
	registerOnce.Do(func() {
		hooksFunc = f
	})
}

// GetHooksFunc returns the registered hooks function for this view.
// Returns an error if no hooks function has been registered.
func GetHooksFunc() (func(*hooks.HookManager), error) {
	if hooksFunc == nil {
		return nil, fmt.Errorf("no hooks function registered for host_groups")
	}
	return hooksFunc, nil
}

// Result represents a row from the host_groups view.
type Result struct {
	Gid       int64  `osquery:"gid"`        // Unsigned int64 group ID
	GidSigned int64  `osquery:"gid_signed"` // Signed int64 version of gid
	Groupname string `osquery:"groupname"`  // Canonical local group name
}

// View returns the view definition for host_groups.
// (Deprecated.) Backward-compatible view over elastic_host_groups; use elastic_host_groups instead.
//
// Columns:
//   - gid (BIGINT): Unsigned int64 group ID
//   - gid_signed (BIGINT): Signed int64 version of gid
//   - groupname (TEXT): Canonical local group name
func View() *hooks.View {
	return hooks.NewView(
		"host_groups",
		[]string{"elastic_host_groups"},
		`CREATE VIEW host_groups AS
SELECT * FROM elastic_host_groups;`,
	)
}
