// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
// or more contributor license agreements. Licensed under the Elastic License;
// you may not use this file except in compliance with the Elastic License.

// Code generated by gentables. DO NOT EDIT.
// Source: views/host_users.yaml

//go:build linux || darwin

package hostusers

import (
	"fmt"
	"sync"

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/hooks"
	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/logger"
)

var (
	hooksFunc    func(*hooks.HookManager)
	registerOnce sync.Once
)

func createViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Create(socket, log)
}

func deleteViewHook(socket *string, log *logger.Logger, hookData any) error {
	v, ok := hookData.(*hooks.View)
	if !ok {
		return fmt.Errorf("hook data is not a view")
	}
	return v.Delete(socket, log)
}

// RegisterDefaultViewHook registers only the create/delete view hook with the hook manager.
// To add extra hooks, call RegisterHooksFunc with a function that calls RegisterDefaultViewHook(hm)
// then registers additional hooks on hm.
func RegisterDefaultViewHook(hm *hooks.HookManager) {
	hm.Register(hooks.NewHook("CreateHostUsersView", createViewHook, deleteViewHook, View()))
}

// RegisterHooksFunc registers the hooks function for this view (optional).
// If called (e.g. from an implementation package), that function runs instead of the default.
// To add extra hooks while keeping the default view hook, pass a function that calls
// RegisterDefaultViewHook(hm) then registers additional hooks.
func RegisterHooksFunc(f func(*hooks.HookManager)) {
	registerOnce.Do(func() {
		hooksFunc = f
	})
}

// GetHooksFunc returns the registered hooks function for this view.
// Returns an error if no hooks function has been registered.
func GetHooksFunc() (func(*hooks.HookManager), error) {
	if hooksFunc == nil {
		return nil, fmt.Errorf("no hooks function registered for host_users")
	}
	return hooksFunc, nil
}

// Result represents a row from the host_users view.
type Result struct {
	Uid         int64  `osquery:"uid"`         // User ID (unsigned)
	Gid         int64  `osquery:"gid"`         // Default group ID (unsigned)
	UidSigned   int64  `osquery:"uid_signed"`  // User ID as int64 signed (for Apple systems)
	GidSigned   int64  `osquery:"gid_signed"`  // Default group ID as int64 signed (for Apple systems)
	Username    string `osquery:"username"`    // Username / login name
	Description string `osquery:"description"` // Optional user description / full name (GECOS field)
	Directory   string `osquery:"directory"`   // User's home directory path
	Shell       string `osquery:"shell"`       // User's configured default shell
	Uuid        string `osquery:"uuid"`        // User's UUID (Apple) or SID (Windows); typically empty on Linux
}

// View returns the view definition for host_users.
// (Deprecated.) Backward-compatible view over elastic_host_users; use elastic_host_users instead.
//
// Columns:
//   - uid (BIGINT): User ID (unsigned)
//   - gid (BIGINT): Default group ID (unsigned)
//   - uid_signed (BIGINT): User ID as int64 signed (for Apple systems)
//   - gid_signed (BIGINT): Default group ID as int64 signed (for Apple systems)
//   - username (TEXT): Username / login name
//   - description (TEXT): Optional user description / full name (GECOS field)
//   - directory (TEXT): User's home directory path
//   - shell (TEXT): User's configured default shell
//   - uuid (TEXT): User's UUID (Apple) or SID (Windows); typically empty on Linux
func View() *hooks.View {
	return hooks.NewView(
		"host_users",
		[]string{"elastic_host_users"},
		`CREATE VIEW host_users AS
SELECT * FROM elastic_host_users;`,
	)
}
