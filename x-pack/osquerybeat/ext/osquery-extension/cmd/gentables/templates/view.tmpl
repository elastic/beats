{{.CopyrightHeader}}{{.CodeGeneratedNotice}}{{.SourceLine}}{{.BuildTagLine}}package {{.PackageName}}

import (
	"fmt"
	"sync"
{{if .NeedsTimeImport}}
	"time"
{{end}}

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/hooks"
{{if .NeedsSharedImport}}
	"{{.SharedImport}}"
{{end}}
)

var (
	hooksFunc    func(*hooks.HookManager)
	registerOnce sync.Once
)

// RegisterHooksFunc registers the hooks function for this view (optional).
// This can be called to register any hooks that should be set up for this view.
func RegisterHooksFunc(f func(*hooks.HookManager)) {
	registerOnce.Do(func() {
		hooksFunc = f
	})
}

// GetHooksFunc returns the registered hooks function for this view.
// Returns an error if no hooks function has been registered.
func GetHooksFunc() (func(*hooks.HookManager), error) {
	if hooksFunc == nil {
		return nil, fmt.Errorf("no hooks function registered for {{.Name}}")
	}
	return hooksFunc, nil
}

// Result represents a row from the {{.Name}} view.
type Result struct {
{{- range .ResultFields }}
{{- if .IsEmbedded }}
{{- if .Comment }}
	// {{.Comment}}
{{- end }}
	{{if .Pointer}}*{{end}}{{.TypeName}}
{{- else }}
	{{.Name}} {{.Type}} {{.Tag}} // {{.Description}}
{{- end }}
{{- end }}
}

// View returns the view definition for {{.Name}}.
// {{.Description}}
//
// Columns:
{{- range .ColumnsComment }}
//   - {{.}}
{{- end }}
func View() *hooks.View {
	return hooks.NewView(
		"{{.Name}}",
		{{.RequiredTables}},
		{{.ViewSQL}},
	)
}
