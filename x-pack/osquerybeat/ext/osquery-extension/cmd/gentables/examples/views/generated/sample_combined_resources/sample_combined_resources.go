// Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
// or more contributor license agreements. Licensed under the Elastic License;
// you may not use this file except in compliance with the Elastic License.

// Code generated by gentables. DO NOT EDIT.
// Source: views/sample_view.yaml

package samplecombinedresources

import (
	"fmt"
	"sync"

	"github.com/elastic/beats/v7/x-pack/osquerybeat/ext/osquery-extension/pkg/hooks"
)

var (
	hooksFunc    func(*hooks.HookManager)
	registerOnce sync.Once
)

// RegisterHooksFunc registers the hooks function for this view (optional).
// This can be called to register any hooks that should be set up for this view.
func RegisterHooksFunc(f func(*hooks.HookManager)) {
	registerOnce.Do(func() {
		hooksFunc = f
	})
}

// GetHooksFunc returns the registered hooks function for this view.
// Returns an error if no hooks function has been registered.
func GetHooksFunc() (func(*hooks.HookManager), error) {
	if hooksFunc == nil {
		return nil, fmt.Errorf("no hooks function registered for sample_combined_resources")
	}
	return hooksFunc, nil
}

// Result represents a row from the sample_combined_resources view.
type Result struct {
	Id               int64   `osquery:"id"`                 // Unique identifier
	Name             string  `osquery:"name"`               // Resource name
	Status           string  `osquery:"status"`             // Current status
	Category         string  `osquery:"category"`           // Resource category
	PriorityLevel    string  `osquery:"priority_level"`     // Human-readable priority level
	AgeDays          int32   `osquery:"age_days"`           // Age in days since creation
	LastModifiedDays int32   `osquery:"last_modified_days"` // Days since last modification
	Value            float64 `osquery:"value"`              // Associated numeric value
}

// View returns the view definition for sample_combined_resources.
// View combining active and archived resources with calculated fields and UNION
//
// Columns:
//   - id (BIGINT): Unique identifier
//   - name (TEXT): Resource name
//   - status (TEXT): Current status
//   - category (TEXT): Resource category
//   - priority_level (TEXT): Human-readable priority level
//   - age_days (INTEGER): Age in days since creation
//   - last_modified_days (INTEGER): Days since last modification
//   - value (DOUBLE): Associated numeric value
func View() *hooks.View {
	return hooks.NewView(
		"sample_combined_resources",
		[]string{"sample_custom_table"},
		`CREATE VIEW sample_combined_resources AS
SELECT 
  id,
  name,
  status,
  category,
  CASE priority
    WHEN 4 THEN 'critical'
    WHEN 3 THEN 'high'
    WHEN 2 THEN 'medium'
    ELSE 'low'
  END AS priority_level,
  (strftime('%s', 'now') - created_time) / 86400 AS age_days,
  (strftime('%s', 'now') - updated_time) / 86400 AS last_modified_days,
  value
FROM sample_custom_table
WHERE status = 'active' AND enabled = 1

UNION ALL

SELECT 
  id,
  name,
  status,
  category,
  CASE priority
    WHEN 4 THEN 'critical'
    WHEN 3 THEN 'high'
    WHEN 2 THEN 'medium'
    ELSE 'low'
  END AS priority_level,
  (strftime('%s', 'now') - created_time) / 86400 AS age_days,
  (strftime('%s', 'now') - updated_time) / 86400 AS last_modified_days,
  value
FROM sample_custom_table
WHERE status = 'archived' AND updated_time > (strftime('%s', 'now') - 2592000);`,
	)
}
