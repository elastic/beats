{
    "description": "Pipeline for parsing Shorewall firewall. Requires the geoip plugin.",
    "processors": [
        {
            "grok": {
                "field": "message",
                "patterns": [
                    "(%{SYSLOGTIMESTAMP:timestamp}) (%{WORD:host.hostname}) kernel:.*Shorewall:(%{WORD:action_1})?:(%{WORD:action_2})?.*IN=(%{USERNAME:nf_in_interface})?.*(OUT= *MAC=(%{COMMONMAC:destination.mac}):(%{COMMONMAC:source.mac})?|OUT=%{USERNAME:nf_out_interface}).*SRC=(%{IPV4:source.ip}).*DST=(%{IPV4:destination.ip}).*LEN=(%{WORD:nf_len:int}).?*TOS=(%{WORD:service.type}).?*PREC=(%{WORD:nf_prec}).?*TTL=(%{INT:nf_ttl:int}).?*ID=(%{INT:nf_id:int}).?*PROTO=(%{WORD:network.protocol}).?*SPT=(%{INT:source.port:int}?.*DPT=%{INT:destination.port:int}?.*)"
                ],
                "ignore_missing": false
            }
        },
        {
            "date": {
                "field": "timestamp",
                "target_field": "@timestamp",
                "formats": ["MMM dd HH:mm:ss"],
                "ignore_failure": false
            }
        },
        {
            "remove": {
                "field": "timestamp"
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
