{
    "description": "Pipeline for parsing Shorewall firewall. Requires the geoip plugin.",
    "processors": [
        {
            "grok": {
                "field": "message",
                "patterns": [
                    "(%{SYSLOGTIMESTAMP:timestamp}) (%{WORD:nf_host}) kernel:.*Shorewall:(%{WORD:nf_action_1})?:(%{WORD:nf_action_2})?.*IN=(%{USERNAME:nf_in_interface})?.*(OUT= *MAC=(%{COMMONMAC:nf_dst_mac}):(%{COMMONMAC:nf_src_mac})?|OUT=%{USERNAME:nf_out_interface}).*SRC=(%{IPV4:nf_src_ip}).*DST=(%{IPV4:nf_dst_ip}).*LEN=(%{WORD:nf_len:int}).?*TOS=(%{WORD:nf_tos}).?*PREC=(%{WORD:nf_prec}).?*TTL=(%{INT:nf_ttl:int}).?*ID=(%{INT:nf_id:int}).?*PROTO=(%{WORD:nf_protocol}).?*SPT=(%{INT:nf_src_port:int}?.*DPT=%{INT:nf_dst_port:int}?.*)"
                ],
                "ignore_missing": false
            }
        },
        {
            "date": {
                "field": "timestamp",
                "target_field": "@timestamp",
                "formats": ["MMM dd HH:mm:ss"],
                "ignore_failure": false
            }
        },
        {
            "remove": {
                "field": "timestamp"
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
