description: Pipeline for parsing cloudflare logs
processors:
- rename:
    field: message
    target_field: event.original
- json:
    field: event.original
    target_field: cloudflare.log
- set:
    field: observer.vendor
    value: Cloudflare
- set:
    field: observer.type
    value: proxy
- pipeline:
    name: '{< IngestPipeline "http" >}'
    if: "ctx.cloudflare?.log?.XXX == 'http'"
- pipeline:
    name: '{< IngestPipeline "firewall" >}'
    if: "ctx.cloudflare?.log?.XXX == 'firewall'"
- pipeline:
    name: '{< IngestPipeline "spectrum" >}'
    if: "ctx.cloudflare?.log?.XXX == 'spectrum'"



on_failure:
- set:
    field: error.message
    value: "{{ _ingest.on_failure_message }}"
