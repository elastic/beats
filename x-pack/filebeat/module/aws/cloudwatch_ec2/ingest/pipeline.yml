description: "Pipeline for EC2 logs in CloudWatch"

processors:
  - grok:
      field: message
      patterns:
        - >-
          %{TIMESTAMP_ISO8601:_tmp.timestamp} %{MONTH:_tmp.month} %{MONTHDAY:_tmp.day} %{TIME:_tmp.time} %{IPORHOST:aws.cloudwatch_ec2.ip_address} %{NOTSPACE:aws.cloudwatch_ec2.program_name}: %{GREEDYDATA:message}

  - date:
      field: "_tmp_.timestamp"
      target_field: "@timestamp"
      ignore_failure: true
      formats:
        - "dd/MMM/yyyy:H:m:s Z"
  - remove:
      field:
        - _tmp
      ignore_missing: true

on_failure:
  - set:
      field: "error.message"
      value: "{{ _ingest.on_failure_message }}"
