{
  "description":"Pipeline for parsing fortinet firewall logs (event pipeline)",
  "processors":[
    {
      "set":{
        "field":"server.ip",
        "value":"{{fortinet.firewall.dstip}}",
        "if":"ctx.fortinet?.firewall?.dstip != null"
      }
    },
    {
      "set":{
        "field":"destination.ip",
        "value":"{{fortinet.firewall.dstip}}",
        "if":"ctx.fortinet?.firewall?.dstip != null"
      }
    },
    {
      "set":{
        "field":"server.port",
        "value":"{{fortinet.firewall.dstport}}",
        "if":"ctx.fortinet?.firewall?.dstport != null"
      }
    },
    {
      "set":{
        "field":"destination.port",
        "value":"{{fortinet.firewall.dstport}}",
        "if":"ctx.fortinet?.firewall?.dstport != null"
      }
    },
    {
      "set":{
        "field":"server.bytes",
        "value":"{{fortinet.firewall.rcvdbyte}}",
        "if":"ctx.fortinet?.firewall?.rcvdbyte != null"
      }
    },
    {
      "set":{
        "field":"destination.bytes",
        "value":"{{fortinet.firewall.rcvdbyte}}",
        "if":"ctx.fortinet?.firewall?.rcvdbyte != null"
      }
    },
    {
      "set":{
        "field":"destination.address",
        "value":"{{fortinet.firewall.daddr}}",
        "if":"ctx.fortinet?.firewall?.daddr != null"
      }
    },
    {
      "set":{
        "field":"server.address",
        "value":"{{fortinet.firewall.daddr}}",
        "if":"ctx.fortinet?.firewall?.daddr != null"
      }
    },
    {
      "set":{
        "field":"server.address",
        "value":"{{fortinet.firewall.dst_host}}",
        "if":"ctx.fortinet?.firewall?.dst_host != null && ctx.server?.address == null"
      }
    },
    {
      "set":{
        "field":"destination.address",
        "value":"{{fortinet.firewall.dst_host}}",
        "if":"ctx.fortinet?.firewall?.dst_host != null && ctx.destination?.address == null"
      }
    },
    {
      "set":{
        "field":"source.user.group.name",
        "value":"{{fortinet.firewall.group}}",
        "if":"ctx.fortinet?.firewall?.group != null && ctx.fortinet?.firewall?.group != 'N/A'"
      }
    },
    {
      "set":{
        "field":"client.user.group.name",
        "value":"{{fortinet.firewall.group}}",
        "if":"ctx.fortinet?.firewall?.group != null && ctx.fortinet?.firewall?.group != 'N/A'"
      }
    },
    {
      "set":{
        "field":"source.bytes",
        "value":"{{fortinet.firewall.sentbyte}}",
        "if":"ctx.fortinet?.firewall?.sentbyte != null"
      }
    },
    {
      "set":{
        "field":"client.bytes",
        "value":"{{fortinet.firewall.sentbyte}}",
        "if":"ctx.fortinet?.firewall?.sentbyte != null"
      }
    },
    {
      "set":{
        "field":"source.ip",
        "value":"{{fortinet.firewall.srcip}}",
        "if":"ctx.fortinet?.firewall?.srcip != null && ctx.source?.ip == null"
      }
    },
    {
      "set":{
        "field":"client.ip",
        "value":"{{fortinet.firewall.srcip}}",
        "if":"ctx.fortinet?.firewall?.srcip != null && ctx.client?.ip == null"
      }
    },
    {
      "set":{
        "field":"source.mac",
        "value":"{{fortinet.firewall.srcmac}}",
        "if":"ctx.fortinet?.firewall?.srcmac != null"
      }
    },
    {
      "set":{
        "field":"client.mac",
        "value":"{{fortinet.firewall.srcmac}}",
        "if":"ctx.fortinet?.firewall?.srcmac != null"
      }
    },
    {
      "set":{
        "field":"source.mac",
        "value":"{{fortinet.firewall.source_mac}}",
        "if":"ctx.fortinet?.firewall?.source_mac != null && ctx.source?.mac == null"
      }
    },
    {
      "set":{
        "field":"client.mac",
        "value":"{{fortinet.firewall.source_mac}}",
        "if":"ctx.fortinet?.firewall?.source_mac != null && ctx.client?.mac == null"
      }
    },
    {
      "set":{
        "field":"source.port",
        "value":"{{fortinet.firewall.srcport}}",
        "if":"ctx.fortinet?.firewall?.srcport != null"
      }
    },
    {
      "set":{
        "field":"client.port",
        "value":"{{fortinet.firewall.srcport}}",
        "if":"ctx.fortinet?.firewall?.srcport != null"
      }
    },
    {
      "set":{
        "field":"source.user.name",
        "value":"{{fortinet.firewall.user}}",
        "if":"ctx.fortinet?.firewall?.user != null && ctx.fortinet?.firewall?.user != 'N/A'"
      }
    },
    {
      "set":{
        "field":"client.user.name",
        "value":"{{fortinet.firewall.user}}",
        "if":"ctx.fortinet?.firewall?.user != null && ctx.fortinet?.firewall?.user != 'N/A'"
      }
    },
    {
      "set":{
        "field":"source.address",
        "value":"{{fortinet.firewall.saddr}}",
        "if":"ctx.fortinet?.firewall?.saddr != null"
      }
    },
    {
      "set":{
        "field":"client.address",
        "value":"{{fortinet.firewall.saddr}}",
        "if":"ctx.fortinet?.firewall?.saddr != null"
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.agent",
        "target_field":"user_agent.original",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.devid",
        "target_field":"observer.serial_number",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.file",
        "target_field":"file.name",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.filesize",
        "target_field":"file.size",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.level",
        "target_field":"log.level",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.logid",
        "target_field":"event.code",
        "ignore_missing":true,
        "if":"ctx.event?.code == null"
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.msg",
        "target_field":"message",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.policyid",
        "target_field":"rule.id",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.proto",
        "target_field":"network.iana_number",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.direction",
        "target_field":"network.direction",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.service",
        "target_field":"network.protocol",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.error",
        "target_field":"error.message",
        "ignore_missing":true,
        "if":"ctx.error?.message == null"
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.error_num",
        "target_field":"error.code",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.hostname",
        "target_field":"url.domain",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.logdesc",
        "target_field":"rule.description",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.url",
        "target_field":"url.path",
        "ignore_missing":true
      }
    },
    {
      "rename":{
        "field":"fortinet.firewall.sess_duration",
        "target_field":"event.duration",
        "ignore_missing":true
      }
    },
    {
      "remove":{
        "field":[
          "fortinet.firewall.locip",
          "fortinet.firewall.locport",
          "fortinet.firewall.srcip",
          "fortinet.firewall.src_ip",
          "fortinet.firewall.src_port",
          "fortinet.firewall.srcport",
          "fortinet.firewall.srcdomain",
          "fortinet.firewall.srcmac",
          "fortinet.firewall.unauthuser",
          "fortinet.firewall.user",
          "fortinet.firewall.sentbyte",
          "fortinet.firewall.rcvdbyte",
          "fortinet.firewall.remip",
          "fortinet.firewall.remport",
          "fortinet.firewall.dstport",
          "fortinet.firewall.dst_port",
          "fortinet.firewall.dstip",
          "fortinet.firewall.recipient"
        ],
        "ignore_missing":true
      }
    }
  ],
  "on_failure":[
    {
      "set":{
        "field":"error.message",
        "value":"{{ _ingest.on_failure_message }}"
      }
    }
  ]
}