{
  "description": "Pipeline for parsing azure signin logs.",
  "processors": [
      {
          "json" : {
              "field" : "message",
              "target_field" : "azure.signinlogs"
          }
      },
      {
          "date": {
              "field": "azure.signinlogs.time",
              "target_field": "@timestamp",
              "ignore_failure": false,
              "formats": [
                  "ISO8601"
              ]
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.resourceId",
              "target_field": "azure.signinlogs.resourceID",
              "ignore_missing": true
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.callerIpAddress",
              "target_field": "source.ip",
              "ignore_missing": true
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.Level",
              "target_field": "log.level",
              "ignore_missing": true
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.durationMs",
              "target_field": "event.duration",
              "ignore_missing": true
          }
      },
      {
          "script": {
              "lang": "painless",
              "source": "ctx.event.duration = ctx.event.duration * params.param_nano",
              "params": {
                  "param_nano": 1000000
              }
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.location",
              "target_field": "geo.country_iso_code",
              "ignore_missing": true
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.resultType",
              "target_field": "event.outcome",
              "ignore_missing": true
          }
      },
      {
          "rename": {
              "field": "azure.signinlogs.category",
              "target_field": "event.category",
              "ignore_missing": true
          }
      },
      {
          "remove": {
              "field": ["message", "azure.signinlogs.time"],
              "ignore_missing": true
          }
      },
      {
          "drop": {
              "if" : "ctx.event.category != 'SignInLogs'"
          }
      }
  ],
  "on_failure": [
  {
    "set": {
      "field": "error.message",
      "value": "{{ _ingest.on_failure_message }}"
    }
  }
  ]
}
