# type: docker
# containers.ids:
#  - "*"
type: log
paths:
{{ range $i, $path := .paths }}
 - {{$path}}
{{ end }}
tags: {{.tags}}
json.keys_under_root: false
processors:
  - drop_fields:
      fields: ["json.stream","json.time"]
  # - add_kubernetes_metadata:
  #    in_cluster: true
  # - drop_event:
  #    when:
  #      not:
  #        and:
  #         - equals:
  #             json.kubernetes.labels.k8s-app: kube-dns
  #         - equals:
  #             json.kubernetes.namespace: kube-system
  - dissect:
      tokenizer: "%{timestamp} [%{log_level}] %{client}:%{port} - %{id} \"%{qtype} %{qclass} %{qname} %{proto} %{size} %{dnssec_ok} %{bufsize}\" %{rcode} %{rflags} %{rsize} %{duration}s"
      field: "json.log"
      target_prefix: "coredns"
  - rename:
      fields:
        - from: "json.kubernetes"
          to: "kubernetes"
        - from: "json.log"
          to: "coredns.message"
  
