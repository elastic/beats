type: log
type: docker
containers.ids:
  - "*"
tags: {{.tags}}
processors:
  - add_kubernetes_metadata:
      in_cluster: true
  - drop_event:
     when:
       not:
         and:
          - equals:
              kubernetes.labels.k8s-app: kube-dns
          - equals:
              kubernetes.namespace: kube-system
  - dissect:
      tokenizer: "%{timestamp} [%{log_level}] %{client}:%{port} - %{id} \"%{qtype} %{qclass} %{name} %{proto} %{size} %{dnssec_ok} %{bufsize}\" %{rcode} %{rflags} %{rsize} %{duration}"
      field: "message"
      target_prefix: "coredns"
