#type: docker
#containers.ids:
#  - "*"
type: log
paths:
{{ range $i, $path := .paths }}
 - {{$path}}
{{ end }}
tags: {{.tags}}
json.keys_under_root: false
processors:
  - rename:
      fields:
        - from: "json.kubernetes"
          to: "kubernetes"
        - from: "json.log"
          to: "coredns.message"
        - from: "json.time"
          to: "coredns.timestamp"
      ignore_missing: true
      fail_on_error: false
  - dissect:
      tokenizer: "%{ts} [%{log_level}] %{client}:%{port} - %{id} \"%{qtype} %{qclass} %{qname} %{proto} %{size} %{dnssec_ok} %{bufsize}\" %{rcode} %{rflags} %{rsize} %{duration}s"
      field: "coredns.message"
      target_prefix: "coredns"
  - drop_event.when:
      or:
        - equals:
            coredns.client: "%{client}"
        - equals:
            coredns.rcode: "%{rcode}"
        - not:
            has_fields: ['coredns.client', 'coredns.rcode']
  - drop_fields:
      fields: ["json", coredns.ts]
