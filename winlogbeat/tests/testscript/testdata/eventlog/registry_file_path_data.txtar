[!windows] skip 'requires Windows'

write-event 'Hello world!'
wait-for-event-log 1
exec winlogbeat -c winlogbeat.yml
check-event-count output 1

# Registry file must be in the custom path, not in the default location.
exists $WORK/custom-data/state/.winlogbeat.yml
! exists $WORK/data/.winlogbeat.yml

-- winlogbeat.yml --
winlogbeat.shutdown_timeout: 30s
winlogbeat.event_logs:
  - name: ${PROVIDER:?missing PROVIDER}
    no_more_events: stop
winlogbeat.registry_file: state/.winlogbeat.yml
path:
  data: ${WORK:?missing WORK}/custom-data
output.file:
  path: ${WORK:?missing WORK}/output
  filename: winlogbeat
  rotate_every_kb: 10000
queue.mem:
  events: 4096
  flush.min_events: 1
  flush.timeout: 0.1s
logging.level: warning
logging.to_files: false
