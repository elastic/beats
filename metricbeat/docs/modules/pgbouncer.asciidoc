////
This file is generated! See scripts/mage/docs_collector.go
////

:modulename: pgbouncer
:edit_url: https://github.com/elastic/beats/edit/main/metricbeat/module/pgbouncer/_meta/docs.asciidoc


[[metricbeat-module-pgbouncer]]
== PGBouncer module

include::{libbeat-dir}/shared/integration-link.asciidoc[]

:modulename!:

PgBouncer is a popular, lightweight connection pooler for PostgreSQL. This module allows you to monitor PgBouncer using Metricbeat, gathering metrics that help optimize performance and maintain stability.

This module periodically fetches metrics from the PgBouncer poolers available at https://www.pgbouncer.org/.

Default metricsets include:
- `lists`: Provides a list of databases and users currently connected to PgBouncer.
- `mem`: Monitors memory usage details within PgBouncer, helping detect memory leaks or spikes.
- `pools`: Tracks the status of connection pools, including active and idle connections.
- `stats`: Collects comprehensive statistics on database connections and queries processed.

[float]
=== Module-specific configuration notes

When configuring the `hosts` option, you must use PostgreSQL URLs of the following format with PgBouncer database name included:

[source,yaml]
-----------------------------------
[postgres://][user:pass@]host[:port]/pgbouncer[?options]
-----------------------------------

The URL can be as simple as:

[source,yaml]
----------------------------------------------------------------------
- module: pgbouncer
  hosts: ["postgres://localhost/pgbouncer"]
----------------------------------------------------------------------

Or more complex like:

[source,yaml]
----------------------------------------------------------------------
- module: pgbouncer
  hosts: ["postgres://localhost/pgbouncer:40001?sslmode=disable", "postgres://otherhost/pgbouncer:40001"]
----------------------------------------------------------------------

Usernames and passwords specified in the URL take precedence over those specified in the `username` and `password` configuration options.
For security best practices, consider using environment variables to pass sensitive information securely.

[source,yaml]
----
- module: postgresql
  metricsets: ["pools"]
  hosts: ["postgres://localhost/pgbouncer:6432"]
  username: root
  password: test
----

:edit_url:

[float]
=== Example configuration

The PGBouncer module supports the standard configuration options that are described
in <<configuration-metricbeat>>. Here is an example configuration:

[source,yaml]
----
metricbeat.modules:
- module: pgbouncer
  enabled: true
  metricsets:
    # Monitors the current state of the connection pools including metrics like active connections, idle connections, waiting connections, and max allowed connections
    # Essential for assessing load and capacity
    - pools

    # Provides comprehensive data on connections, pools, and queries including total queries, average query duration, and query rates
    # Useful for performance tuning and identifying bottlenecks
    - stats

    # Details current activity of the PgBouncer service showing lists of databases and users
    # Helps in auditing access and understanding user distribution
    - lists

    # Reports on the sizes of internal memory allocations to track memory usage and potential leaks, critical for maintaining system stability
    - memory

  period: 10s

  # The host must be passed as PostgreSQL URL. Example:
  # postgres://localhost/pgbouncer:6432?sslmode=disable
  # The available parameters are documented here:
  # https://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters
  # You have to specify the pgbouncer as the database name.
  hosts: ["postgres://localhost/pgbouncer:6432"]

  # Username to use when connecting to PostgreSQL. Empty by default.
  #username: user

  # Password to use when connecting to PostgreSQL. Empty by default.
  #password: pass
----

[float]
=== Metricsets

The following metricsets are available:

* <<metricbeat-metricset-pgbouncer-lists,lists>>

* <<metricbeat-metricset-pgbouncer-mem,mem>>

* <<metricbeat-metricset-pgbouncer-pools,pools>>

* <<metricbeat-metricset-pgbouncer-stats,stats>>

include::pgbouncer/lists.asciidoc[]

include::pgbouncer/mem.asciidoc[]

include::pgbouncer/pools.asciidoc[]

include::pgbouncer/stats.asciidoc[]

:edit_url!:
