default: true
input:
  module: http
  metricset: json
  defaults:
    method: POST
    namespace: "json_namespace"
    basepath: "/request"
    headers:
      Content-Type: application/json
    query:
      wait: "1"
    body: '{"prefix": "status", "format": "json"}'

processors:
  - extract_array:
      field: http.json_namespace.finished
      mappings:
        ceph.request: 0
  - decode_json_fields:
      fields: ["ceph.request.outb"]
      process_array: true
      target: "ceph.mgr_cluster_status"
  - rename:
      ignore_missing: true
      fields:
        - from: "ceph.mgr_cluster_status.osdmap.osdmap"
        - to: "ceph.mgr_cluster_status._tmp_osdmap"
  - drop_fields:
      ignore_missing: true
      fields:
        - "http"
        - "ceph.request"
        - "ceph.mgr_cluster_status.mgrmap"
        - "ceph.mgr_cluster_status.servicemap"
        - "ceph.mgr_cluster_status.health.checks"
        - "ceph.mgr_cluster_status.progress_events"
        - "ceph.mgr_cluster_status.osdmap"
  - rename:
      ignore_missing: true
      fields:
        - from: "ceph.mgr_cluster_status._tmp_osdmap"
        - to: "ceph.mgr_cluster_status.osdmap"
