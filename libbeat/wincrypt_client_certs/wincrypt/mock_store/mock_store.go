package mock_store

import (
	"encoding/base64"
	"github.com/elastic/beats/libbeat/wincrypt_client_certs/wincrypt"
	"syscall"
)

const pfxBase64 = `
MIIKtgIBAzCCCnIGCSqGSIb3DQEHAaCCCmMEggpfMIIKWzCCBhwGCSqGSIb3DQEHAaCCBg0EggYJ
MIIGBTCCBgEGCyqGSIb3DQEMCgECoIIE/jCCBPowHAYKKoZIhvcNAQwBAzAOBAh0Rx27RtoAaQIC
B9AEggTY2x2XFEOA55Ubq/IghRzwvXHbQnqyCU4RaKbsiqrVyQVHdzc4L1mRh9CapM5CDxIpLpS9
s0Jtad4mklQW9rylLaydMxlPg6ga91xH3obFBY7Bixgmo3iCvJvitHStJcHsNGL2rUiWeF6gKhfh
7CjAwvqJQwNQ49Y2UXj5h51JdsBNa+1jW+XmsTNdVup0WgxzG2ZBxwvTpbdPSDePzsxvZrYr2Pxl
Gy7N+1LB5xkRZ17CZZHjqbwSZQiYaT+XP9063gIye21yagl1ScF+H4efk+7fYybXSKEEA/60Aw0o
jgthiQsiON//17AnXDwVkJujcxgelnV89joy2kNXEB9nGbU9XlwLawCYmwrN+OfO6mQE+TL9dRs5
YI2xdg/wgjMsXp3qWSv/c7XUGocg+mZZvjyy8v9wBwWzbKA/4of3rTX1MrlPBni6jIuJrJQrcpNL
zHoqwkb6ysuRvfFeU47UDxI8gGaQ8sKuwQJ3vaI/W7DdvY93siaqw8VvdiY9Cmti+w+Cw6drCwSM
iHkT22nz7Oc0nFa1dSTciA8Q/ftCZ5XWsoEDXrzXnkWkUavZPLXS5Hbc0lB3AEUltR9wr/GYNiVl
w7z3HHPLtRivBFcU65Zs/vKpTNKZhHG/dkln14Fe8XlIELtwOIJ/nRww4hcPY/ROD665ozEzUhLh
Yto8DO6/ffTDxAzxErSQVoqcgrkRV6XAHYMCIy0ws4d07bEueLYapw2JGc0ufMGi2BtwxfEWcW17
ADpyoETtl06xjivwIdr+zzf3BMl9ksu6vY7dyBSdW9YmKBAEaTDXwg//r4s1S4KmMi8hlAQN6JZ3
uEBUgPJFfU1EjwyzNctm7ffzHxmM/LgmdmGr4NU6vkGfAmSUjlI+iBfdAajwGB7yrQCkTB1I5NZC
z/ZtAqbUg4jYF9SlgyI1LjRixMaUYHmSZA+V/3wEWhI/Akjr1Wtprdpw1CiQ0pNHah9g+qADgtd1
s6rBJRxPeXXpxZnfre2JdW86mvq+Pztp4r1l4hOT73gnGU20BXSAV3LblTQdMSgPzI63/z23KS+h
BivYmnmHwNoJJcjRf6qykGM8VQ63oHtkFqd1GCMXUINZj20cV4usXMdExYHAq2BEck9Wc5g+1z3+
oJbPkfBChyboWUr2i9S+eQFFzzj13j6KVtMTTizBciL5Q+n/rLlU0EZGVt8kthDczN5u9Qjnxx8z
UexHXQnSMSbSqeqPlb8bmCO6bh5R2qk+UZ91fGE6GPCGkplOgCRgHN2Lc1kmwiy0eMaxOVqcYrCX
4Y5b2EVLp8/Je5ZD4tRgDoeP2qbAWtuHsOhSUJWWpX8HSQZcANGFmGxfqk0w+pSmCMO+vrjw1rx+
y2bq95mtFovOrtFgwIAi/CbI9XSYV8fKFEzrI+So1XJKWc+yHwPzRubHxfbrfSM0GV6HX4thiuOK
xORlyl/XU5g79cK598dwyMz37mYC0dKCKmOXWvjGXd8HyTbqD7ChGUG2FH6rQAmypbhiQpEhjUB2
v5J27/1o2FU02pu0K6nea6IhJ9N4bZ/3uSwUqS+bAvu3bKuPNfNMFH7QhU2NPg6fgkZgEf4GgIBG
72844oozpZA56TI3GoTID3xWt0csiDFjQBbnsO15iH7XhdMqDnktbm97ZTM40acYIzGB7zATBgkq
hkiG9w0BCRUxBgQEAQAAADBdBgkrBgEEAYI3EQExUB5OAE0AaQBjAHIAbwBzAG8AZgB0ACAAUwBv
AGYAdAB3AGEAcgBlACAASwBlAHkAIABTAHQAbwByAGEAZwBlACAAUAByAG8AdgBpAGQAZQByMHkG
CSqGSIb3DQEJFDFsHmoAdABlAHMAdAAuAGUAeABhAG0AcABsAGUALgBvAHIAZwAtADEAMwA2ADkA
MABiAGIAZgAtAGQAMQBmADEALQA0ADQAMgAwAC0AYgAxADUAMQAtADEAZgAzADIANgAyADcAYQBj
AGYAMAA5MIIENwYJKoZIhvcNAQcGoIIEKDCCBCQCAQAwggQdBgkqhkiG9w0BBwEwHAYKKoZIhvcN
AQwBAzAOBAjP2rB3khJhXgICB9CAggPwxSiuXAHtkIie2Dgs1hvJImbKZRUOAt0iinn+klH7ccVR
pPn04rRPAlot49i4g9kVDV2+FWddFgU425LgijNqguU8KHopiJ7fkzST8heayTo0Mq9kHLx7wWxn
2dfKpe7BKeHfmJCT+HhuhhimGlCsrfjiQQxRaej3nggdOgTWI9WR3C5foU/PLFlF90YJnZmxZWNO
bq51pyXLMF1SmFfoJj88nKQYQ5I5UP3BMFbgdth4kaKmf9bNc4B+RcbSQ56tFYI4lGGHYNOyl3RR
tPehNloKhwJPbO7uvGWx7YF0LyxXRGe98E7t5fS5ulJIwdrmjk44N0Vk7/y3wLf/P5nNr4q62lTJ
Y0hoGlOOyT+1eRJf/45sK4PVv5fnx4zDIuwVlx7z52232PP+yGrwFXupihTwR+8RrVx/UzIE6rRo
3Yblc670dP+nIu5dgMqA+B6W4iFdrfCpmRdumAcCey7DJpml7QcpT8fnTL+A6T3Q/8AI0tTKkvET
2LSsDzE88p92qb4n5f3CTlSRBypRDX02d62p3eorx7iVJD1qgr/kiZrnzT+6UAE3bEa25H4AWUTE
L7WnGlTDfeSq+PJ40AT0eM/nT5VGBkqXD01m3axMIrkTlLspcHKSBrAL9PlZAmD9ke6ezuXknVTW
ju6z2n0dvIrWb7sa6+yBuhiWN6hCoIuyspJsHu4mG0etg8I0KrhKzuqyQipoMgPcg6jj4qXH63qB
Fq7mr1vONrOx91OHACAhxTo1ZT/Wt/5zEVzSaHDo0v341LGGUFrkEIlfE7+YyBZ3r1WV8YS+MJ+o
/8cr9uYqwSSsw8ea8n0GPP2EoxN7J9jQdSpveWewuloKlElDH28DE+QHJsqw4jesAFpNrSOtmy7m
nbxkouONNzC1VWjB7c0GgnPae5S2SYT1OkF2K+M6SjcbGVmOF/VjNcUFmX5I5f7dgTJw9PmH2OLq
MgdDz7OY6xU6ERkglLEudTQqNu6TaTL1OWp+cZ+A6elMZwJP012X9qS23a9LtqbIdUl1TUY4PMuV
IqpJzyXJT4Eqth9asXJ3bQndn59/uAtC7nlWa0t2SzbVVLmzjIqcoeVR46c9CKoaVtiGaIsJmCah
GfztNomoVaE/M7UbdBe6dXJPg5j/WavWusBhZgAtuu+Tjfqf5xfj5r3TYSjaSJUbnWv+RDdLMnS4
ADa+Vf4AzsKR4RMbnr1BUPYRygxpLOVUmYWzr4IbWx172crPS0L+hPQPu6r612gN0DUJNmnosx2u
7d0c0w9s5fYeZebrKRCqED91EJJMr9SzytrvAwGI0oEVxLy04wYqZHRcjXeS4KpXiv6Kk/Y76/mV
TmNriO5kMDswHzAHBgUrDgMCGgQU1BpVpbgEaIxXg8+80XPcFe8pO40EFIeeu+v75BAL96WnD5bR
bv3IWufiAgIH0A==
`

// Generate a dummy store with a single test certificate.
func New() (wincrypt.HCERTSTORE, error) {
	password, _ := syscall.UTF16PtrFromString("test")

	pfxdata, _ := base64.StdEncoding.DecodeString(pfxBase64)

	store, err := wincrypt.PFXImportCertStore(
		&wincrypt.CRYPT_DATA_BLOB{
			CbData: uint32(len(pfxdata)),
			PbData: &pfxdata[0],
		},
		password,
		wincrypt.PKCS12_NO_PERSIST_KEY,
	)

	if err != nil {
		return 0, err
	}

	return store, nil
}
